# 笔记
## 简介
本项目是一个测试 git 使用的项目。
## 项目
初始化时，包含以下文件：
- 笔记.md
- README.md
- .gitignore

# git hook 配置-pre-commit
## 简介
1、背景
我们需要给项目增加 git hook 配置，而 git hook 的配置包含 2 个步骤：
配置 pre-commit；
配置 lint-staged；
2、目的
本项目主要讲解如何配置 pre-commit，重点是 pre-commit 的基本使用，即脚本选项的设置。
3、参考
https://www.npmjs.com/package/pre-commit
## 项目 1
1、复制`lqbz/buildWorkspace/eslintWorkspace/gs-eslint/2-eslint 配置-文件分类`到 gitWorkspace/。
2、运行
```shell
eslint src/**
```
3、结果
控制台无输出，即 eslint 校验通过。
## 项目 2
1、在`项目 1`基础上继续
2、安装 pre-commit
```shell
npm install --save-dev pre-commit
```
3、配置 pre-commit
修改 package.json
```json
    {
        ...
        "scripts": { // 自定义一些脚本
-+          "test": "echo \"Error: I SHOULD FAIL LOLOLOLOLOL \" && exit 1",
+           "foo": "echo \"fooo\" && exit 0",
+           "bar": "echo \"bar\" && exit 0"
        },
+       "pre-commit": [ // 执行 git commit 时，会先执行 pre-commit，即按顺序执行数组里的脚本。
+           "foo",
+           "bar",
+           "test"
+       ],
        ...
    }
```
4、保存代码
```shell
git add .
```
5、提交代码
```shell
git commit -m "配置pre-commit"
```
6、结果
1）代码提交成功
2）控制台输出
```shell
fooo
bar
Error: I SHOULD FAIL LOLOLOLOLOL 
pre-commit: 
pre-commit: We've failed to pass the specified git pre-commit hooks as the `test`
pre-commit: hook returned an exit code (1). If you're feeling adventurous you can
pre-commit: skip the git pre-commit hooks by adding the following flags to your commit:
pre-commit: 
pre-commit:   git commit -n (or --no-verify)
pre-commit: 
pre-commit: This is ill-advised since the commit is broken.
pre-commit: 
```
7、结论
提交代码失败：无法通过指定的 pre-commit 钩子，因为执行 npm run test 时返回了错误码 1。 
## 项目 3
1、在`项目 2`基础上继续
2、修改 packagae.json
```json
    {
        ...
        "scripts": {
-+          "test": "echo \"Error: I SHOULD FAIL LOLOLOLOLOL \" && exit 0", // 退出码由 1 改为 0
            "foo": "echo \"fooo\" && exit 0",
            "bar": "echo \"bar\" && exit 0"
        },
        ...
    }
```
3、保存代码
```shell
git add .
```
4、提交代码
```shell
git commit -m "配置pre-commit"
```
5、结果
1）代码提交成功
2）控制台输出
```shell
fooo
bar
Error: I SHOULD FAIL LOLOLOLOLOL 
[main 36019a8] 配置pre-commit
 2 files changed, 74 insertions(+), 4 deletions(-)
```

# git hook 配置-pre-commit2
## 简介
1、背景
我们需要给项目增加 git hook 配置，而 git hook 的配置包含 2 个步骤：
配置 pre-commit；
配置 lint-staged；
2、目的
`git hook 配置-pre-commit`主要讲解了 pre-commit 的基本使用，即脚本选项的设置，本项目主要讲解其他选项的设置。
3、参考
https://www.npmjs.com/package/pre-commit
## 项目
1、在`git hook 配置-pre-commit`的基础上继续
2、其他
省略。

# git hook 配置-lint-staged
## 简介
1、背景
我们需要给项目增加 git hook 配置，而 git hook 的配置包含 2 个步骤：
配置 pre-commit；
配置 lint-staged；
2、目的
本项目主要讲解如何配置 lint-staged。
3、参考
https://github.com/okonet/lint-staged#configuration
4、内容
```shell
# lint-staged 的作用
对暂存的 git 文件运行 linter，不要让屎滑进你的代码库！
# 为什么？
在提交代码之前运行Linting更有意义。通过这样做，您可以确保没有错误进入存储库并强制执行代码样式。但是在整个项目上运行lint过程是很慢的，而且lint结果可能是不相关的。最终，您只希望lint将要提交的文件。

此项目包含一个脚本，该脚本将运行以暂存文件列表为参数的任意shell任务，并按指定的glob模式进行筛选。
# 相关博客文章与讲座
介绍性中后期-AndreyOkonetchnikov，2016
在每次Git提交之前运行Jest测试-BenMcCormick，2017
AgentConf演示-AndreyOkonechnikov，2018
SurviveJS访谈-JuhoVepsäläinen和AndreyOkonechnikov，2018
使用dotnet格式和lint stage使您的CSharp更漂亮
如果你写了一个，请提交一个带有链接的公关！
# 安装和设置
开始使用lint staged的最快方法是在终端中运行以下命令：
npx mrm@2 lint-staged

`此命令将根据项目的package.json依赖项中的代码质量工具安装和配置husky和lint staged，因此请确保在此之前安装（npm install--save dev）并配置所有代码质量工具，如Prettier和ESLint。`

不要忘记提交对package.json和.husky的更改，以便与您的团队共享此设置！

现在更改一些文件，git add或git add——将其中一些文件修补到提交中，然后尝试git提交它们。

有关更多信息，请参阅示例和配置。
# 迁移
省略。
# 命令行标志
省略。
```
## 项目 1
1、在`git hook 配置-pre-commit2`的基础上继续
2、背景
因为 lint-staged 要求 Node 版本不低于 12.13.0，所以需要升级 node
```shell
nvm list
nvm use v14.16.0
```
3、安装 lint-staged
```shell
npx mrm@2 lint-staged
```
4、结果
1）新增 .husky
2）package.json 被修改了
```json
{
  "name": "1-eslint",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: I SHOULD FAIL LOLOLOLOLOL \" && exit 0",
    "foo": "echo \"fooo\" && exit 0",
    "bar": "echo \"bar\" && exit 0",
+   "prepare": "husky install"
  },
  "pre-commit": [
    "foo",
    "bar",
    "test"
  ],
+ "lint-staged": {
+   "*.js": "eslint --cache --fix"
+ },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "@babel/eslint-plugin": "^7.14.5",
    "@baidu/eslint-config-sfe-typescript": "^1.0.3",
    "eslint": "^7.30.0",
+   "husky": "^7.0.1",
+   "lint-staged": "^11.0.0",
    "pre-commit": "^1.2.2"
  }
}
```
5、提交代码
```shell
git add .
git commit -m "安装lint-staged"
```
5、结果
1）代码提交成功
2）控制台输出：被暂存的文件没有匹配 lint-staged 配置的。
```shell
ℹ No staged files match any configured task.
[main d5830a2] 安装lint-staged
 5 files changed, 728 insertions(+), 7 deletions(-)
 create mode 100644 .husky/.gitignore
 create mode 100755 .husky/pre-commit
```
## 项目 2
1、在`项目 1`基础上继续
2、


## 项目 2【废弃】
1、在`git hook 配置-pre-commit2`的基础上继续
2、安装 lint-staged
```shell
npm install --save-dev lint-staged
```
3、修改 package.json
```json
{
    ...
    "scripts": {
        "test": "echo \"Error: I SHOULD FAIL LOLOLOLOLOL \" && exit 0",
        "foo": "echo \"fooo\" && exit 0",
        "bar": "echo \"bar\" && exit 0",
+       "lint-staged": "lint-staged"
    },
    "pre-commit": [
        "foo",
        "bar",
        "test",
+       "lint-staged"
    ],
+   "lint-staged": {
+       "src/**/*.ts": "eslint"
+   }
    ...
}
```
4、
